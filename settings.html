<!doctype html>
<html lang="en" class="antialiased">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Settings — Finance Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>html{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto}</style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900 pb-28">
  <div class="p-4">
    <header class="flex items-center justify-between">
      <div>
        <h2 class="text-lg font-semibold">Settings</h2>
        <p class="text-sm text-slate-500">Personalize and manage data</p>
      </div>
      <div><a href="dashboard.html" class="px-3 py-2 bg-white rounded shadow">Back</a></div>
    </header>

    <div class="mt-4 bg-white p-4 rounded-2xl shadow space-y-4">
      <div>
        <h4 class="font-semibold">Credentials</h4>
        <form id="credForm" class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2">
          <input id="setUsername" class="p-2 border rounded" placeholder="Username" />
          <input id="setPassword" type="password" class="p-2 border rounded" placeholder="Password" />
          <div class="sm:col-span-2">
            <button class="px-3 py-2 bg-amber-500 text-white rounded">Save Credentials</button>
          </div>
        </form>
      </div>

      <div>
        <h4 class="font-semibold">Theme</h4>
        <div class="mt-2 flex items-center gap-4">
          <label class="flex items-center gap-2"><input type="radio" name="theme" value="light"> Light</label>
          <label class="flex items-center gap-2"><input type="radio" name="theme" value="dark"> Dark</label>
        </div>
      </div>

      <div>
        <h4 class="font-semibold">View (Font)</h4>
        <div class="mt-2 grid grid-cols-2 gap-2">
          <select id="fontSize" class="p-2 border rounded">
            <option value="small">Small</option>
            <option value="medium">Medium</option>
            <option value="large">Large</option>
          </select>
          <select id="fontFamily" class="p-2 border rounded">
            <option>Inter</option>
            <option>Roboto</option>
            <option>Open Sans</option>
          </select>
        </div>
      </div>

      <div>
        <h4 class="font-semibold">Data Management</h4>
        <div class="mt-2 flex gap-2">
          <button id="exportAllCsv" class="px-3 py-2 bg-slate-800 text-white rounded">Export All CSV</button>
          <button id="exportAllPdf" class="px-3 py-2 bg-slate-800 text-white rounded">Export All PDF</button>
          <button id="clearAll" class="px-3 py-2 bg-red-600 text-white rounded">Clear All Data</button>
        </div>
      </div>

      <div>
        <button id="logoutBtn" class="px-4 py-2 bg-slate-100 rounded">Logout</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
    <footer class="fixed bottom-12 left-0 right-0 flex justify-center">
      <div class="bg-white p-2 rounded-full shadow text-xs">
        © copyright basith paravoor
        <a class="text-amber-500 ml-1" href="https://wa.me/7994531823?text=Expense%20Tracker" target="_blank">Contact</a>
      </div>
    </footer>
  <!-- Bottom nav -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t shadow sm:hidden">
      <div class="flex justify-around p-2">
        <a href="dashboard.html" class="text-slate-700 text-center py-2">
          <div class="text-xs font-semibold">Dashboard</div>
        </a>
        <a href="expenses.html" class="text-slate-700 text-center py-2">
          <div class="text-xs font-semibold">Expenses</div>
        </a>
        <a href="incomes.html" class="text-slate-700 text-center py-2">
          <div class="text-xs font-semibold">Incomes</div>
        </a>
        <a href="viewbyname.html" class="text-slate-700 text-center py-2">
          <div class="text-xs font-semibold">By Name</div>
        </a>
      </div>
    </nav>

  <script src="app.js"></script>
  <script>
    if(localStorage.getItem('tfm_logged_in') !== 'true') location.href='index.html';
    // load settings
    const settings = JSON.parse(localStorage.getItem('tfm_settings')||'{"theme":"light","fontSize":"medium","fontFamily":"Inter"}');
    document.querySelectorAll('input[name="theme"]').forEach(r=> r.checked = (r.value === settings.theme));
    document.getElementById('fontSize').value = settings.fontSize || 'medium';
    document.getElementById('fontFamily').value = settings.fontFamily || 'Inter';

    function applySettings(){
      const s = JSON.parse(localStorage.getItem('tfm_settings')||'{}');
      if(s.theme === 'dark') document.documentElement.classList.add('dark'), document.body.classList.add('bg-slate-900','text-white');
      else document.documentElement.classList.remove('dark'), document.body.classList.remove('bg-slate-900','text-white');
      // font size
      if(s.fontSize === 'small') document.documentElement.style.fontSize = '14px';
      else if(s.fontSize === 'large') document.documentElement.style.fontSize = '18px';
      else document.documentElement.style.fontSize = '16px';
      // font family
      document.documentElement.style.fontFamily = s.fontFamily || 'Inter';
    }
    applySettings();

    // theme change
    document.querySelectorAll('input[name="theme"]').forEach(r=> r.addEventListener('change', function(){
      const s = JSON.parse(localStorage.getItem('tfm_settings')||'{}'); s.theme = this.value; localStorage.setItem('tfm_settings', JSON.stringify(s)); applySettings();
    }));

    document.getElementById('fontSize').addEventListener('change', function(){
      const s = JSON.parse(localStorage.getItem('tfm_settings')||'{}'); s.fontSize = this.value; localStorage.setItem('tfm_settings', JSON.stringify(s)); applySettings();
    });
    document.getElementById('fontFamily').addEventListener('change', function(){
      const s = JSON.parse(localStorage.getItem('tfm_settings')||'{}'); s.fontFamily = this.value; localStorage.setItem('tfm_settings', JSON.stringify(s)); applySettings();
    });

    // credentials save
    document.getElementById('credForm').addEventListener('submit', function(e){
      e.preventDefault();
      const u = document.getElementById('setUsername').value.trim();
      const p = document.getElementById('setPassword').value;
      if(!u || !p) return alert('Provide both username and password.');
      localStorage.setItem('tfm_credentials', JSON.stringify({username:u, password:p}));
      alert('Saved. Next login will use new credentials.');
    });

    // export all csv/pdf
    document.getElementById('exportAllCsv').addEventListener('click', ()=>{
      // combine incomes and expenses into separate csvs and download as files
      const inc = JSON.parse(localStorage.getItem('tfm_incomes')||'[]');
      const exp = JSON.parse(localStorage.getItem('tfm_expenses')||'[]');
      function downloadCSV(arr, filename, header){
        if(arr.length === 0){ alert(filename + ' — no data'); return; }
        const csv = [header.join(',')].concat(arr.map(r=> header.map(h=> `"${(r[h]||'').toString().replace(/"/g,'""')}"`).join(','))).join('\n');
        const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url);
      }
      downloadCSV(inc, 'incomes.csv', ['id','date','purpose','name','phone','amount','lastDate','createdAt']);
      downloadCSV(exp, 'expenses.csv', ['id','date','purpose','name','phone','amount','createdAt']);
    });

    document.getElementById('exportAllPdf').addEventListener('click', ()=>{
      exportListAsPDF('tfm_incomes','incomes_all.pdf');
      exportListAsPDF('tfm_expenses','expenses_all.pdf');
    });

    document.getElementById('clearAll').addEventListener('click', ()=>{
      if(!confirm('Clear ALL data (incomes, expenses, contacts, settings)? This is irreversible.')) return;
      localStorage.removeItem('tfm_incomes'); localStorage.removeItem('tfm_expenses'); localStorage.removeItem('tfm_contacts');
      alert('Cleared. You will remain logged in.');
    });

    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      localStorage.removeItem('tfm_logged_in'); location.href='index.html';
    });
  </script>
</body>
</html>
