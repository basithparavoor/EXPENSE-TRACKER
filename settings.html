<!doctype html>
<html lang="en" class="antialiased">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Settings — FinAssist</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#005f4b">
  <style>html{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto} .card-appear{transform:translateY(8px);opacity:0;animation:comeUp .36s forwards}@keyframes comeUp{to{transform:none;opacity:1}}</style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900">
  <div class="max-w-3xl mx-auto p-4">
    <header class="flex items-center justify-between gap-4 mb-4">
      <div class="flex items-center gap-3">
        <img src="logo.png" alt="FinAssist" class="h-10 w-auto">
        <div>
          <h1 class="text-2xl font-semibold leading-tight">Settings</h1>
          <p class="text-sm text-slate-500">Theme, view and data management</p>
        </div>
      </div>
      <a href="dashboard.html" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white shadow text-sm">Back</a>
    </header>

    <div class="grid lg:grid-cols-3 gap-4">
      <div class="lg:col-span-2 space-y-4">
        <!-- Theme & Appearance -->
        <section class="bg-white rounded-2xl p-4 shadow card-appear">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-semibold">Theme & Appearance</h2>
              <p class="text-sm text-slate-500 mt-1">Toggle dark mode and adjust typography.</p>
            </div>
            <div class="text-sm text-slate-400">Preview</div>
          </div>

          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <div class="text-sm font-medium mb-2">Theme</div>
              <div class="flex gap-3">
                <label class="cursor-pointer inline-flex items-center gap-2 px-3 py-2 rounded-lg border" id="themeLight">
                  <input type="radio" name="theme" value="light" class="hidden">
                  <div class="w-8 h-5 rounded bg-white border"></div>
                  <div class="text-sm">Light</div>
                </label>
                <label class="cursor-pointer inline-flex items-center gap-2 px-3 py-2 rounded-lg border" id="themeDark">
                  <input type="radio" name="theme" value="dark" class="hidden">
                  <div class="w-8 h-5 rounded bg-slate-800"></div>
                  <div class="text-sm">Dark</div>
                </label>
              </div>
            </div>

            <div>
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-sm font-medium">Typography</div>
                  <div class="text-xs text-slate-500">Size & font family</div>
                </div>
                <div><span class="text-xs text-slate-400">Global</span></div>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-2">
                <select id="fontSize" class="p-2 border rounded-lg">
                  <option value="small">Small</option>
                  <option value="medium">Medium</option>
                  <option value="large">Large</option>
                </select>
                <select id="fontFamily" class="p-2 border rounded-lg">
                  <option>Inter</option>
                  <option>Roboto</option>
                  <option>Open Sans</option>
                </select>
              </div>
            </div>
          </div>

          <div class="mt-4 border border-dashed rounded-lg p-3 bg-slate-50">
            <div id="previewBox" class="p-3 rounded">
              <div class="flex items-center gap-3">
                <div class="bg-white p-2 rounded-md shadow"><img src="favicon.png" class="h-6 w-6" alt=""></div>
                <div>
                  <div id="previewTitle" class="font-semibold text-slate-800">FinAssist</div>
                  <div id="previewSubtitle" class="text-xs text-slate-500">Your personal finance companion</div>
                </div>
              </div>
              <div class="mt-3 text-sm text-slate-600">Preview sample text — amounts: <span class="font-semibold">₹ 12,345</span></div>
            </div>
          </div>
        </section>

        <!-- Data Management -->
        <section class="bg-white rounded-2xl p-4 shadow card-appear">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-semibold">Data Management</h2>
              <p class="text-sm text-slate-500 mt-1">Export or clear all local data. Use carefully — clearing is irreversible.</p>
            </div>
            <div class="text-sm text-slate-400">Local Storage</div>
          </div>

          <div class="mt-4 flex flex-col sm:flex-row gap-3">
            <button id="exportAllCsv" class="w-full sm:w-auto px-4 py-2 rounded-lg bg-slate-800 text-white">Export CSV</button>
            <button id="exportAllPdf" class="w-full sm:w-auto px-4 py-2 rounded-lg bg-slate-800 text-white">Export PDF</button>
            <button id="clearAll" class="w-full sm:w-auto px-4 py-2 rounded-lg bg-rose-600 text-white">Clear All</button>
            <button id="downloadBackup" class="w-full sm:w-auto px-4 py-2 rounded-lg bg-amber-500 text-slate-900">Download Backup</button>
          </div>

          <div class="mt-3 text-xs text-slate-500">Tip: Export before clearing. Backups are saved as a JSON file you can re-import if needed (manual).</div>
        </section>

        <!-- Support & About -->
        <section class="bg-white rounded-2xl p-4 shadow card-appear">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-semibold">Support & About</h2>
              <p class="text-sm text-slate-500 mt-1">Information about the app and quick contact.</p>
            </div>
            <div class="text-sm text-slate-400">v1.0</div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
              <div class="text-sm font-medium">Website</div>
              <a class="block mt-1 text-amber-600" href="https://www.finassist.space" target="_blank">www.finassist.space</a>
            </div>
            <div>
              <div class="text-sm font-medium">Contact</div>
              <a class="block mt-1 text-amber-600" href="https://wa.me/7994531823?text=FinAssist%20Support" target="_blank">WhatsApp Support</a>
            </div>
          </div>
        </section>

        <div class="flex justify-end">
          <button id="goToAccount" class="px-4 py-2 rounded bg-slate-100">Open My Account</button>
        </div>

      </div>

      <!-- right column -->
      <aside class="space-y-4">
        <div class="bg-white rounded-2xl p-4 shadow card-appear">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="font-semibold">Account</h3>
              <p class="text-xs text-slate-500">Edit credentials in My Account</p>
            </div>
            <img src="favicon.png" class="h-8 w-8" alt="logo">
          </div>
          <div class="mt-3 text-sm text-slate-600">
            <div><span class="text-slate-500">User:</span> <span id="showUser">—</span></div>
            <div class="mt-1"><span class="text-slate-500">Entries:</span> <span id="showCounts">0 incomes / 0 expenses</span></div>
          </div>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow card-appear">
          <h3 class="font-semibold">Quick Actions</h3>
          <div class="mt-3 flex flex-col gap-2">
            <button id="btnExportCSV" class="px-3 py-2 rounded bg-slate-50">Export Incomes CSV</button>
            <button id="btnExportEXP" class="px-3 py-2 rounded bg-slate-50">Export Expenses CSV</button>
            <button id="btnClearContacts" class="px-3 py-2 rounded bg-rose-50 text-rose-700">Clear Contacts</button>
          </div>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow card-appear">
          <h3 class="font-semibold">Danger Zone</h3>
          <p class="text-xs text-slate-500 mt-1">Irreversible actions</p>
          <div class="mt-3">
            <button id="btnDangerClearAll" class="w-full px-3 py-2 rounded bg-rose-600 text-white">Clear All Data</button>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <footer class="fixed bottom-4 left-1/2 -translate-x-1/2">
    <div class="bg-white p-2 rounded-full shadow text-xs flex items-center gap-2">
      <img src="favicon.png" class="h-4 w-4" alt="FinAssist">
      <a class="text-slate-700" href="https://wa.me/7994531823?text=Expense%20Tracker" target="_blank">© copyright basith paravoor</a>
    </div>
  </footer>

  <script src="app.js"></script>
  <script>
    if(localStorage.getItem('tfm_logged_in') !== 'true') location.href='index.html';

    // Read settings helper
    const $ = id => document.getElementById(id);
    function readSettings(){ return JSON.parse(localStorage.getItem('tfm_settings') || '{"theme":"light","fontSize":"medium","fontFamily":"Inter"}'); }
    function writeSettings(s){ localStorage.setItem('tfm_settings', JSON.stringify(s)); window.dispatchEvent(new Event('storage')); }

    // apply local preview
    function applyLocalPreview(){
      const s = readSettings();
      // radio selection visual
      document.querySelectorAll('[name="theme"]').forEach(r=> r.checked = (r.value === s.theme));
      $('fontSize').value = s.fontSize || 'medium';
      $('fontFamily').value = s.fontFamily || 'Inter';
      // preview adjustment
      const preview = $('previewBox');
      preview.style.fontFamily = s.fontFamily;
      preview.style.fontSize = s.fontSize === 'small' ? '14px' : s.fontSize === 'large' ? '18px' : '16px';
      if(s.theme === 'dark') document.documentElement.classList.add('tfm-dark'); else document.documentElement.classList.remove('tfm-dark');
    }

    applyLocalPreview();

    // theme selectors
    document.querySelectorAll('[name="theme"]').forEach(r => r.addEventListener('change', function(){
      const s = readSettings(); s.theme = this.value; writeSettings(s); applyLocalPreview();
    }));
    document.getElementById('themeLight').addEventListener('click', ()=>{ document.querySelector('[name="theme"][value="light"]').checked = true; const s = readSettings(); s.theme='light'; writeSettings(s); applyLocalPreview(); });
    document.getElementById('themeDark').addEventListener('click', ()=>{ document.querySelector('[name="theme"][value="dark"]').checked = true; const s = readSettings(); s.theme='dark'; writeSettings(s); applyLocalPreview(); });

    $('fontSize').addEventListener('change', function(){ const s = readSettings(); s.fontSize = this.value; writeSettings(s); applyLocalPreview(); });
    $('fontFamily').addEventListener('change', function(){ const s = readSettings(); s.fontFamily = this.value; writeSettings(s); applyLocalPreview(); });

    // data actions
    $('exportAllCsv').addEventListener('click', function(){
      const incomes = JSON.parse(localStorage.getItem('tfm_incomes')||'[]');
      const expenses = JSON.parse(localStorage.getItem('tfm_expenses')||'[]');
      window.downloadArrayAsCsv(incomes, 'incomes.csv', Object.keys(incomes[0]||{}).length?Object.keys(incomes[0]):['id','date','name','amount']);
      window.downloadArrayAsCsv(expenses, 'expenses.csv', Object.keys(expenses[0]||{}).length?Object.keys(expenses[0]):['id','date','name','amount']);
    });
    $('exportAllPdf').addEventListener('click', function(){ window.exportListAsPDF('tfm_incomes','incomes.pdf'); window.exportListAsPDF('tfm_expenses','expenses.pdf'); });

    $('clearAll').addEventListener('click', function(){
      if(!confirm('Clear all local data (incomes, expenses, contacts, profile)? This cannot be undone.')) return;
      localStorage.removeItem('tfm_incomes'); localStorage.removeItem('tfm_expenses'); localStorage.removeItem('tfm_contacts'); localStorage.removeItem('tfm_profile');
      alert('All local data cleared.');
      location.reload();
    });

    $('downloadBackup').addEventListener('click', function(){
      const backup = {
        incomes: JSON.parse(localStorage.getItem('tfm_incomes')||'[]'),
        expenses: JSON.parse(localStorage.getItem('tfm_expenses')||'[]'),
        contacts: JSON.parse(localStorage.getItem('tfm_contacts')||'[]'),
        profile: JSON.parse(localStorage.getItem('tfm_profile')||'{}'),
      };
      const blob = new Blob([JSON.stringify(backup, null, 2)], {type:'application/json'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'finassist-backup.json'; a.click(); URL.revokeObjectURL(a.href);
    });

    $('goToAccount').addEventListener('click', ()=> location.href='myaccount.html');

    // show user summary
    function updateSummary(){
      const creds = JSON.parse(localStorage.getItem('tfm_credentials')||'{}');
      const incomes = JSON.parse(localStorage.getItem('tfm_incomes')||'[]');
      const expenses = JSON.parse(localStorage.getItem('tfm_expenses')||'[]');
      $('showUser').textContent = creds.username || '—';
      $('showCounts').textContent = `${incomes.length} incomes / ${expenses.length} expenses`;
    }
    updateSummary();

    // clear contacts
    $('btnClearContacts').addEventListener('click', function(){
      if(!confirm('Clear all contacts?')) return;
      localStorage.removeItem('tfm_contacts');
      alert('Contacts cleared.');
    });

    // dangerous clear all
    $('btnDangerClearAll').addEventListener('click', function(){
      if(!confirm('This will remove ALL app data. Are you sure?')) return;
      localStorage.clear();
      alert('LocalStorage cleared.');
      location.reload();
    });

  </script>
</body>
</html>
